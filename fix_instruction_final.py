#!/usr/bin/env python3
# -*- coding: utf-8 -*-

def fix_instruction_final():
    filepath = 'server/internal/test/runner/instruction.go'
    
    with open(filepath, 'rb') as f:
        content = f.read()
    
    # 修复第712行的注释问题
    # 查找 "实际不需要做什" 后面跟着 tab 或空格然后 "//" 的模式
    pattern1 = b'// \xe8\xbf\x99\xe4\xb8\xaa\xe6\x93\x8d\xe4\xbd\x9c\xe4\xb8\xbb\xe8\xa6\x81\xe6\x98\xaf\xe4\xb8\xba\xe4\xba\x86\xe6\xb5\x8b\xe8\xaf\x95\xef\xbc\x8c\xe5\xae\x9e\xe9\x99\x85\xe4\xb8\x8d\xe9\x9c\x80\xe8\xa6\x81\xe5\x81\x9a\xe4\xbb\x80\xef\xbf\xbd\t//'
    replacement1 = b'// \xe8\xbf\x99\xe4\xb8\xaa\xe6\x93\x8d\xe4\xbd\x9c\xe4\xb8\xbb\xe8\xa6\x81\xe6\x98\xaf\xe4\xb8\xba\xe4\xba\x86\xe6\xb5\x8b\xe8\xaf\x95\xef\xbc\x8c\xe5\xae\x9e\xe9\x99\x85\xe4\xb8\x8d\xe9\x9c\x80\xe8\xa6\x81\xe5\x81\x9a\xe4\xbb\x80\xe4\xb9\x88\n\t//'
    
    if pattern1 in content:
        content = content.replace(pattern1, replacement1)
        print("修复了第712行的注释问题")
    else:
        # 尝试其他可能的编码
        pattern2 = b'// \xe8\xbf\x99\xe4\xb8\xaa\xe6\x93\x8d\xe4\xbd\x9c\xe4\xb8\xbb\xe8\xa6\x81\xe6\x98\xaf\xe4\xb8\xba\xe4\xba\x86\xe6\xb5\x8b\xe8\xaf\x95\xef\xbc\x8c\xe5\xae\x9e\xe9\x99\x85\xe4\xb8\x8d\xe9\x9c\x80\xe8\xa6\x81\xe5\x81\x9a\xe4\xbb\x80'
        if pattern2 in content:
            # 查找这个模式后面跟着 tab 和 // 的位置
            pos = content.find(pattern2)
            if pos != -1:
                # 检查后面是否有 tab 和 //
                after_comment = content[pos+len(pattern2):pos+len(pattern2)+10]
                if b'\t//' in after_comment or b' //' in after_comment:
                    # 替换为正确的格式
                    new_comment = b'// \xe8\xbf\x99\xe4\xb8\xaa\xe6\x93\x8d\xe4\xbd\x9c\xe4\xb8\xbb\xe8\xa6\x81\xe6\x98\xaf\xe4\xb8\xba\xe4\xba\x86\xe6\xb5\x8b\xe8\xaf\x95\xef\xbc\x8c\xe5\xae\x9e\xe9\x99\x85\xe4\xb8\x8d\xe9\x9c\x80\xe8\xa6\x81\xe5\x81\x9a\xe4\xbb\x80\xe4\xb9\x88\n'
                    # 找到 // 的位置
                    comment2_pos = content.find(b'//', pos+len(pattern2))
                    if comment2_pos != -1:
                        # 替换从注释开始到第二个注释之前的部分
                        content = content[:pos] + new_comment + content[comment2_pos:]
                        print("修复了第712行的注释问题（方法2）")
    
    with open(filepath, 'wb') as f:
        f.write(content)

if __name__ == '__main__':
    fix_instruction_final()

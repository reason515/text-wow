# 技能系统 - Buff/Debuff测试
test_suite: "技能系统 - Buff/Debuff"
description: "测试Buff和Debuff系统，包括效果应用、持续时间、叠加规则等"

tests:
  - name: "Buff应用测试"
    description: "测试Buff效果的应用"
    category: "integration"
    priority: "high"
    setup:
      - "创建一个攻击力=20的角色"
      - "准备一个Buff技能：战斗怒吼（攻击力+30%，持续5回合）"
    steps:
      - action: "角色使用战斗怒吼技能"
        expected: "角色获得攻击力+30%的Buff"
        assertions:
          - "角色应该获得Buff效果"
          - "攻击力应该提升30%"
          - "Buff持续时间应该为5回合"
    assertions:
      - type: "equals"
        target: "character.buff_attack_modifier"
        expected: "0.3"
        message: "Buff应该提供30%攻击力加成"
      - type: "equals"
        target: "character.buff_duration"
        expected: "5"
        message: "Buff持续时间应该为5回合"
      - type: "approximately"
        target: "character.actual_attack"
        expected: "26"
        tolerance: 1.0
        message: "实际攻击力应该约为26（20×1.3）"

  - name: "Debuff应用测试"
    description: "测试Debuff效果的应用"
    category: "integration"
    priority: "high"
    setup:
      - "创建一个防御力=20的怪物"
      - "准备一个Debuff技能：破甲（防御力-25%，持续3回合）"
    steps:
      - action: "对怪物使用破甲技能"
        expected: "怪物获得防御力-25%的Debuff"
        assertions:
          - "怪物应该获得Debuff效果"
          - "防御力应该降低25%"
    assertions:
      - type: "equals"
        target: "monster.debuff_defense_modifier"
        expected: "-0.25"
        message: "Debuff应该降低25%防御力"
      - type: "approximately"
        target: "monster.actual_defense"
        expected: "15"
        tolerance: 1.0
        message: "实际防御力应该约为15（20×0.75）"

  - name: "Buff持续时间测试"
    description: "测试Buff的持续时间倒计时"
    category: "integration"
    priority: "high"
    setup:
      - "创建一个角色"
      - "角色获得一个持续3回合的Buff"
    steps:
      - action: "执行第1回合"
        expected: "Buff剩余时间=2回合"
      - action: "执行第2回合"
        expected: "Buff剩余时间=1回合"
      - action: "执行第3回合"
        expected: "Buff剩余时间=0回合，Buff消失"
    assertions:
      - type: "equals"
        target: "character.buff_duration_round_1"
        expected: "2"
        message: "第1回合后Buff剩余时间应该为2"
      - type: "equals"
        target: "character.buff_duration_round_3"
        expected: "0"
        message: "第3回合后Buff应该消失"
      - type: "equals"
        target: "character.has_buff"
        expected: "false"
        message: "Buff消失后角色不应该有Buff"

  - name: "Buff叠加测试"
    description: "测试相同类型Buff的叠加规则"
    category: "integration"
    priority: "medium"
    setup:
      - "创建一个攻击力=20的角色"
      - "准备两个攻击力Buff：+20%和+30%"
    steps:
      - action: "角色获得第一个Buff（+20%）"
        expected: "攻击力提升20%"
      - action: "角色获得第二个Buff（+30%）"
        expected: "根据叠加规则处理（覆盖或叠加）"
    assertions:
      - type: "greater_than"
        target: "character.actual_attack"
        expected: "20"
        message: "实际攻击力应该提升"

  - name: "Buff覆盖测试"
    description: "测试新Buff覆盖旧Buff的情况"
    category: "integration"
    priority: "medium"
    setup:
      - "创建一个角色"
      - "角色已有一个攻击力+20%的Buff（剩余2回合）"
    steps:
      - action: "角色获得一个新的攻击力+30%的Buff"
        expected: "新Buff覆盖旧Buff，攻击力加成变为30%"
    assertions:
      - type: "equals"
        target: "character.buff_attack_modifier"
        expected: "0.3"
        message: "Buff加成应该为30%（新Buff）"

  - name: "治疗Buff（HOT）测试"
    description: "测试持续治疗（HOT）效果"
    category: "integration"
    priority: "high"
    setup:
      - "创建一个角色，HP=50/100"
      - "准备一个HOT技能：每回合恢复10点HP，持续3回合"
    steps:
      - action: "角色获得HOT效果"
        expected: "每回合恢复10点HP"
      - action: "执行第1回合"
        expected: "角色HP增加10点，HP=60"
      - action: "执行第2回合"
        expected: "角色HP增加10点，HP=70"
      - action: "执行第3回合"
        expected: "角色HP增加10点，HP=80，HOT效果结束"
    assertions:
      - type: "equals"
        target: "character.hp_round_1"
        expected: "60"
        message: "第1回合后HP应该为60"
      - type: "equals"
        target: "character.hp_round_3"
        expected: "80"
        message: "第3回合后HP应该为80"

  - name: "伤害Buff（DOT）测试"
    description: "测试持续伤害（DOT）效果"
    category: "integration"
    priority: "high"
    setup:
      - "创建一个怪物，HP=100"
      - "准备一个DOT技能：每回合造成15点伤害，持续4回合"
    steps:
      - action: "对怪物使用DOT技能"
        expected: "怪物每回合受到15点伤害"
      - action: "执行第1回合"
        expected: "怪物HP减少15点，HP=85"
      - action: "执行第2回合"
        expected: "怪物HP减少15点，HP=70"
      - action: "执行第4回合"
        expected: "怪物HP减少15点，DOT效果结束"
    assertions:
      - type: "equals"
        target: "monster.hp_round_1"
        expected: "85"
        message: "第1回合后HP应该为85"
      - type: "equals"
        target: "monster.hp_round_4"
        expected: "55"
        message: "第4回合后HP应该为55"

  - name: "Buff驱散测试"
    description: "测试驱散Buff的能力"
    category: "integration"
    priority: "medium"
    setup:
      - "创建一个角色，拥有攻击力+30%的Buff"
      - "准备一个驱散技能"
    steps:
      - action: "对角色使用驱散技能"
        expected: "角色的Buff被驱散"
    assertions:
      - type: "equals"
        target: "character.has_buff"
        expected: "false"
        message: "Buff应该被驱散"
      - type: "equals"
        target: "character.buff_attack_modifier"
        expected: "0"
        message: "攻击力加成应该消失"

  - name: "多个Buff同时存在测试"
    description: "测试角色同时拥有多个不同类型Buff的情况"
    category: "integration"
    priority: "medium"
    setup:
      - "创建一个角色"
    steps:
      - action: "角色获得攻击力+20%的Buff"
        expected: "角色获得第一个Buff"
      - action: "角色获得防御力+15%的Buff"
        expected: "角色获得第二个Buff，两个Buff同时存在"
    assertions:
      - type: "equals"
        target: "character.buff_count"
        expected: "2"
        message: "角色应该同时拥有2个Buff"
      - type: "equals"
        target: "character.buff_attack_modifier"
        expected: "0.2"
        message: "攻击力Buff应该存在"
      - type: "equals"
        target: "character.buff_defense_modifier"
        expected: "0.15"
        message: "防御力Buff应该存在"










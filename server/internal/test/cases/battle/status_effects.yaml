# 战斗系统 - 状态效果测试
test_suite: "战斗系统 - 状态效果"
description: "测试战斗中的各种状态效果，包括眩晕、沉默、定身等"

tests:
  - name: "眩晕状态测试"
    description: "测试角色被眩晕后无法行动"
    category: "integration"
    priority: "high"
    setup:
      - "创建一个角色，HP=100，攻击力=20"
      - "创建一个怪物，HP=100"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "怪物对角色施加眩晕状态（持续1回合）"
        expected: "角色获得眩晕状态"
      - action: "执行一个回合"
        expected: "角色无法行动"
      - action: "执行第2回合"
        expected: "眩晕状态消失，角色可以行动"
    assertions:
      - type: "equals"
        target: "character.is_stunned"
        expected: "true"
        message: "第1回合角色应该处于眩晕状态"
      - type: "equals"
        target: "character.action_count_round_1"
        expected: "0"
        message: "眩晕状态下角色不应该有行动"
      - type: "equals"
        target: "character.is_stunned"
        expected: "false"
        message: "第2回合眩晕状态应该消失"

  - name: "沉默状态测试"
    description: "测试角色被沉默后无法使用技能"
    category: "integration"
    priority: "high"
    setup:
      - "创建一个角色，HP=100，怒气=100/100"
      - "创建一个消耗30点怒气的技能"
      - "创建一个怪物，HP=100"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "怪物对角色施加沉默状态（持续2回合）"
        expected: "角色获得沉默状态"
      - action: "角色尝试使用技能"
        expected: "技能无法使用（被沉默）"
      - action: "角色进行普通攻击"
        expected: "普通攻击可以使用"
      - action: "执行第3回合"
        expected: "沉默状态消失，角色可以使用技能"
    assertions:
      - type: "equals"
        target: "character.is_silenced"
        expected: "true"
        message: "角色应该处于沉默状态"
      - type: "equals"
        target: "skill_use_failed"
        expected: "true"
        message: "沉默状态下技能使用应该失败"
      - type: "greater_than"
        target: "damage_dealt"
        expected: "0"
        message: "普通攻击应该可以造成伤害"

  - name: "定身状态测试"
    description: "测试角色被定身后无法移动但可以攻击"
    category: "integration"
    priority: "medium"
    setup:
      - "创建一个角色，HP=100，攻击力=20"
      - "创建一个怪物，HP=100"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "怪物对角色施加定身状态（持续1回合）"
        expected: "角色获得定身状态"
      - action: "角色攻击怪物"
        expected: "角色可以攻击（定身不影响攻击）"
      - action: "角色尝试移动"
        expected: "角色无法移动（被定身）"
    assertions:
      - type: "equals"
        target: "character.is_rooted"
        expected: "true"
        message: "角色应该处于定身状态"
      - type: "greater_than"
        target: "damage_dealt"
        expected: "0"
        message: "定身状态下角色应该可以攻击"

  - name: "恐惧状态测试"
    description: "测试角色被恐惧后随机行动"
    category: "integration"
    priority: "medium"
    setup:
      - "创建一个角色，HP=100，攻击力=20"
      - "创建一个怪物，HP=100"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "怪物对角色施加恐惧状态（持续1回合）"
        expected: "角色获得恐惧状态"
      - action: "执行一个回合"
        expected: "角色随机行动（可能攻击、防御或逃跑）"
    assertions:
      - type: "equals"
        target: "character.is_feared"
        expected: "true"
        message: "角色应该处于恐惧状态"
      - type: "equals"
        target: "character.action_type"
        expected: "random"
        message: "恐惧状态下角色应该随机行动"

  - name: "免疫状态测试"
    description: "测试角色免疫某些状态效果"
    category: "integration"
    priority: "medium"
    setup:
      - "创建一个角色，HP=100"
      - "创建一个怪物，HP=100"
      - "给角色添加眩晕免疫Buff"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "怪物对角色施加眩晕状态"
        expected: "眩晕状态被免疫，角色不受影响"
    assertions:
      - type: "equals"
        target: "character.is_stunned"
        expected: "false"
        message: "免疫状态下角色不应该被眩晕"
      - type: "equals"
        target: "status_effect_applied"
        expected: "false"
        message: "状态效果应该被免疫"

  - name: "状态效果叠加测试"
    description: "测试多个状态效果同时存在"
    category: "integration"
    priority: "medium"
    setup:
      - "创建一个角色，HP=100"
      - "创建一个怪物，HP=100"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "怪物对角色施加眩晕状态（持续1回合）"
      - action: "怪物对角色施加沉默状态（持续2回合）"
        expected: "角色同时拥有眩晕和沉默状态"
    assertions:
      - type: "equals"
        target: "character.status_effect_count"
        expected: "2"
        message: "角色应该拥有2个状态效果"
      - type: "equals"
        target: "character.is_stunned"
        expected: "true"
        message: "角色应该处于眩晕状态"
      - type: "equals"
        target: "character.is_silenced"
        expected: "true"
        message: "角色应该处于沉默状态"

  - name: "状态效果持续时间测试"
    description: "测试状态效果的持续时间机制"
    category: "integration"
    priority: "medium"
    setup:
      - "创建一个角色，HP=100"
      - "创建一个怪物，HP=100"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "怪物对角色施加眩晕状态（持续3回合）"
        expected: "角色获得眩晕状态"
      - action: "执行第1回合"
        expected: "眩晕状态持续，剩余2回合"
      - action: "执行第2回合"
        expected: "眩晕状态持续，剩余1回合"
      - action: "执行第3回合"
        expected: "眩晕状态持续，剩余0回合"
      - action: "执行第4回合"
        expected: "眩晕状态消失"
    assertions:
      - type: "equals"
        target: "character.stun_duration_round_1"
        expected: "3"
        message: "第1回合眩晕持续时间应该为3"
      - type: "equals"
        target: "character.stun_duration_round_2"
        expected: "2"
        message: "第2回合眩晕持续时间应该为2"
      - type: "equals"
        target: "character.stun_duration_round_3"
        expected: "1"
        message: "第3回合眩晕持续时间应该为1"
      - type: "equals"
        target: "character.is_stunned"
        expected: "false"
        message: "第4回合眩晕状态应该消失"

  - name: "状态效果清除测试"
    description: "测试使用技能清除状态效果"
    category: "integration"
    priority: "medium"
    setup:
      - "创建一个角色，HP=100"
      - "创建一个清除状态效果的技能"
      - "创建一个怪物，HP=100"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "怪物对角色施加眩晕状态"
        expected: "角色获得眩晕状态"
      - action: "角色使用清除状态效果技能"
        expected: "眩晕状态被清除"
    assertions:
      - type: "equals"
        target: "character.is_stunned"
        expected: "false"
        message: "状态效果应该被清除"
      - type: "equals"
        target: "status_effect_removed"
        expected: "true"
        message: "状态效果移除标志应该为true"


















































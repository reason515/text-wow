# 战斗系统 - 怪物技能测试
test_suite: "战斗系统 - 怪物技能"
description: "测试怪物在战斗中使用技能的各种场景"

tests:
  - name: "怪物使用技能攻击测试"
    description: "测试怪物使用技能攻击角色"
    category: "integration"
    priority: "high"
    setup:
      - "创建一个角色，HP=100，防御力=10"
      - "创建一个怪物，攻击力=15，HP=100"
      - "给怪物添加一个造成150%攻击力伤害的技能"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "怪物使用技能攻击角色"
        expected: "怪物技能造成更高伤害"
    assertions:
      - type: "greater_than"
        target: "monster_skill_damage_dealt"
        expected: "15"
        message: "怪物技能伤害应该大于普通攻击（考虑防御减伤后约20）"
      - type: "less_than"
        target: "character.hp"
        expected: "100"
        message: "角色HP应该减少"

  - name: "怪物技能冷却测试"
    description: "测试怪物技能的冷却机制"
    category: "integration"
    priority: "high"
    setup:
      - "创建一个角色，HP=200"
      - "创建一个怪物，HP=100"
      - "给怪物添加一个冷却时间为2回合的技能"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "怪物使用技能（第1回合）"
        expected: "技能可以使用"
      - action: "执行一个回合"
        expected: "技能进入冷却"
      - action: "怪物尝试使用技能（第2回合）"
        expected: "技能冷却中，无法使用"
      - action: "执行一个回合"
        expected: "技能冷却结束"
      - action: "怪物使用技能（第3回合）"
        expected: "技能可以再次使用"
    assertions:
      - type: "equals"
        target: "monster_skill_cooldown_round_2"
        expected: "1"
        message: "第2回合技能应该还在冷却"
      - type: "equals"
        target: "monster_skill_cooldown_round_3"
        expected: "0"
        message: "第3回合技能冷却应该结束"

  - name: "怪物Buff技能测试"
    description: "测试怪物使用Buff技能增强自己"
    category: "integration"
    priority: "medium"
    setup:
      - "创建一个角色，攻击力=20"
      - "创建一个怪物，攻击力=15，防御力=10"
      - "给怪物添加一个攻击力+50%的Buff技能（持续3回合）"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "怪物使用Buff技能"
        expected: "怪物攻击力提升50%"
      - action: "怪物攻击角色"
        expected: "怪物造成更高伤害"
    assertions:
      - type: "greater_than"
        target: "monster_damage_dealt"
        expected: "15"
        message: "Buff后怪物伤害应该更高（约22）"
      - type: "equals"
        target: "monster_buff_duration"
        expected: "3"
        message: "Buff持续时间应该为3回合"

  - name: "怪物Debuff技能测试"
    description: "测试怪物使用Debuff技能削弱角色"
    category: "integration"
    priority: "medium"
    setup:
      - "创建一个角色，攻击力=20，防御力=10"
      - "创建一个怪物，HP=100"
      - "给怪物添加一个降低角色攻击力-30%的Debuff技能（持续2回合）"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "怪物使用Debuff技能"
        expected: "角色攻击力降低30%"
      - action: "角色攻击怪物"
        expected: "角色造成更低伤害"
    assertions:
      - type: "less_than"
        target: "damage_dealt"
        expected: "18"
        message: "Debuff后角色伤害应该降低（约12）"
      - type: "equals"
        target: "character_debuff_duration"
        expected: "2"
        message: "Debuff持续时间应该为2回合"

  - name: "怪物AOE技能测试"
    description: "测试怪物使用AOE技能攻击多个目标"
    category: "integration"
    priority: "high"
    setup:
      - "创建一个3人队伍：战士(HP=100)、牧师(HP=100)、法师(HP=100)"
      - "创建一个怪物，攻击力=20"
      - "给怪物添加一个AOE技能（对所有角色造成80%攻击力伤害）"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "怪物使用AOE技能"
        expected: "所有角色受到伤害"
    assertions:
      - type: "less_than"
        target: "character_1.hp"
        expected: "100"
        message: "战士HP应该减少"
      - type: "less_than"
        target: "character_2.hp"
        expected: "100"
        message: "牧师HP应该减少"
      - type: "less_than"
        target: "character_3.hp"
        expected: "100"
        message: "法师HP应该减少"
      - type: "greater_than"
        target: "monster_aoe_damage_dealt"
        expected: "40"
        message: "AOE总伤害应该大于40"

  - name: "怪物治疗技能测试"
    description: "测试怪物使用治疗技能恢复HP"
    category: "integration"
    priority: "medium"
    setup:
      - "创建一个角色，攻击力=20"
      - "创建一个怪物，HP=50/100"
      - "给怪物添加一个恢复30点HP的治疗技能"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "角色攻击怪物"
        expected: "怪物HP减少到30"
      - action: "怪物使用治疗技能"
        expected: "怪物HP恢复30点"
    assertions:
      - type: "equals"
        target: "monster.hp"
        expected: "60"
        message: "怪物HP应该恢复到60"
      - type: "equals"
        target: "monster_healing_dealt"
        expected: "30"
        message: "怪物治疗量应该为30"

  - name: "怪物技能资源消耗测试"
    description: "测试怪物技能的资源消耗机制"
    category: "integration"
    priority: "medium"
    setup:
      - "创建一个角色，HP=100"
      - "创建一个怪物，HP=100，资源=100/100"
      - "给怪物添加一个消耗40点资源的技能"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "怪物使用技能"
        expected: "怪物资源减少40点"
    assertions:
      - type: "equals"
        target: "monster.resource"
        expected: "60"
        message: "使用技能后怪物资源应该为60"
      - type: "equals"
        target: "monster_skill_resource_cost"
        expected: "40"
        message: "技能资源消耗应该为40"

  - name: "怪物技能暴击测试"
    description: "测试怪物技能可以触发暴击"
    category: "unit"
    priority: "medium"
    setup:
      - "创建一个角色，HP=100，防御力=10"
      - "创建一个怪物，攻击力=20，物理暴击率=100%，物理暴击伤害=150%"
      - "给怪物添加一个造成120%攻击力伤害的技能"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "怪物使用技能攻击角色（必定暴击）"
        expected: "怪物技能造成暴击伤害"
    assertions:
      - type: "equals"
        target: "monster_skill_is_crit"
        expected: "true"
        message: "怪物技能应该触发暴击"
      - type: "greater_than"
        target: "monster_skill_crit_damage"
        expected: "30"
        message: "怪物技能暴击伤害应该大于30（考虑防御减伤后约32）"


















































# 战斗系统 - 边界情况测试
test_suite: "战斗系统 - 边界情况"
description: "测试战斗系统的边界情况和极端场景"

tests:
  - name: "HP=1时战斗测试"
    description: "测试角色HP=1时的战斗行为"
    category: "unit"
    priority: "medium"
    setup:
      - "创建一个角色，HP=1/100，攻击力=20"
      - "创建一个怪物，HP=10，攻击力=5"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "角色攻击怪物"
        expected: "角色可以攻击"
      - action: "怪物攻击角色"
        expected: "角色受到5点伤害，HP归零，死亡"
    assertions:
      - type: "equals"
        target: "character.hp"
        expected: "0"
        message: "角色HP应该为0（死亡）"
      - type: "equals"
        target: "battle_state"
        expected: "defeat"
        message: "战斗状态应该为失败"

  - name: "资源=0时战斗测试"
    description: "测试角色资源为0时的战斗行为"
    category: "unit"
    priority: "medium"
    setup:
      - "创建一个角色，怒气=0/100，攻击力=20"
      - "创建一个消耗30点怒气的技能"
      - "创建一个怪物，HP=100"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "角色尝试使用技能"
        expected: "资源不足，无法使用技能"
      - action: "角色进行普通攻击"
        expected: "角色可以使用普通攻击"
    assertions:
      - type: "equals"
        target: "skill_use_failed"
        expected: "true"
        message: "技能使用应该失败"
      - type: "greater_than"
        target: "damage_dealt"
        expected: "0"
        message: "普通攻击应该造成伤害"

  - name: "极高防御力测试"
    description: "测试防御力极高时的伤害计算（至少1点伤害）"
    category: "unit"
    priority: "low"
    setup:
      - "创建一个角色，攻击力=10"
      - "创建一个怪物，防御力=1000"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "角色攻击怪物"
        expected: "即使防御很高，也应该至少造成1点伤害"
    assertions:
      - type: "greater_than_or_equal"
        target: "damage_dealt"
        expected: "1"
        message: "应该至少造成1点伤害"

  - name: "极高攻击力测试"
    description: "测试攻击力极高时的伤害计算"
    category: "unit"
    priority: "low"
    setup:
      - "创建一个角色，攻击力=1000"
      - "创建一个怪物，防御力=10，HP=100"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "角色攻击怪物"
        expected: "造成极高伤害，可能一击秒杀"
    assertions:
      - type: "greater_than"
        target: "damage_dealt"
        expected: "100"
        message: "应该造成超过100点伤害"
      - type: "equals"
        target: "monster.hp"
        expected: "0"
        message: "怪物应该被秒杀"

  - name: "同时触发暴击和闪避测试"
    description: "测试暴击和闪避的判定顺序"
    category: "unit"
    priority: "low"
    setup:
      - "创建一个角色，攻击力=20，物理暴击率=100%"
      - "创建一个怪物，闪避率=100%"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "角色攻击怪物"
        expected: "闪避优先判定，攻击被闪避，不触发暴击"
    assertions:
      - type: "equals"
        target: "is_dodged"
        expected: "true"
        message: "攻击应该被闪避"
      - type: "equals"
        target: "damage_dealt"
        expected: "0"
        message: "被闪避的攻击不造成伤害"

  - name: "Buff持续时间=0测试"
    description: "测试持续时间为0的Buff（立即消失）"
    category: "unit"
    priority: "low"
    setup:
      - "创建一个角色"
      - "给角色添加攻击力+50%的Buff（持续0回合）"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "执行第1回合"
        expected: "Buff立即消失"
    assertions:
      - type: "equals"
        target: "buff_count"
        expected: "0"
        message: "Buff应该立即消失"

  - name: "怪物HP=1时战斗测试"
    description: "测试怪物HP=1时的战斗行为"
    category: "unit"
    priority: "low"
    setup:
      - "创建一个角色，攻击力=5"
      - "创建一个怪物，HP=1，防御力=0"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "角色攻击怪物"
        expected: "怪物受到伤害，HP归零，死亡"
    assertions:
      - type: "equals"
        target: "monster.hp"
        expected: "0"
        message: "怪物HP应该为0（死亡）"
      - type: "equals"
        target: "battle_state"
        expected: "victory"
        message: "战斗状态应该为胜利"

  - name: "同时死亡测试"
    description: "测试角色和怪物同时死亡的情况"
    category: "unit"
    priority: "medium"
    setup:
      - "创建一个角色，HP=5，攻击力=10"
      - "创建一个怪物，HP=5，攻击力=10"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "角色和怪物同时攻击（同归于尽）"
        expected: "双方同时死亡，战斗应该判定为失败（角色死亡）"
    assertions:
      - type: "equals"
        target: "character.hp"
        expected: "0"
        message: "角色HP应该为0"
      - type: "equals"
        target: "monster.hp"
        expected: "0"
        message: "怪物HP应该为0"
      - type: "equals"
        target: "battle_state"
        expected: "defeat"
        message: "同时死亡时应该判定为失败（角色死亡优先）"

  - name: "资源耗尽测试"
    description: "测试角色资源耗尽时的战斗行为"
    category: "unit"
    priority: "medium"
    setup:
      - "创建一个角色，怒气=0/100，攻击力=20"
      - "创建一个需要30点怒气的技能"
      - "创建一个怪物，HP=100"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "角色尝试使用技能"
        expected: "资源不足，无法使用技能，应该使用普通攻击"
      - action: "角色进行普通攻击"
        expected: "普通攻击应该成功，并获得5点怒气"
    assertions:
      - type: "equals"
        target: "skill_use_failed"
        expected: "true"
        message: "资源不足时技能使用应该失败"
      - type: "greater_than"
        target: "character.resource_after_attack"
        expected: "0"
        message: "普通攻击后应该获得怒气"
      - type: "greater_than"
        target: "damage_dealt"
        expected: "0"
        message: "普通攻击应该造成伤害"

  - name: "所有角色死亡测试"
    description: "测试所有角色都死亡时的战斗结束判定"
    category: "integration"
    priority: "high"
    setup:
      - "创建2个角色，HP=1"
      - "创建1个怪物，攻击力=10"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "怪物攻击角色1"
        expected: "角色1死亡"
      - action: "怪物攻击角色2"
        expected: "角色2死亡，战斗应该结束（失败）"
    assertions:
      - type: "equals"
        target: "character_1.hp"
        expected: "0"
        message: "角色1应该死亡"
      - type: "equals"
        target: "character_2.hp"
        expected: "0"
        message: "角色2应该死亡"
      - type: "equals"
        target: "battle_state"
        expected: "defeat"
        message: "所有角色死亡时战斗应该判定为失败"
      - type: "equals"
        target: "all_characters_dead"
        expected: "true"
        message: "应该标记为所有角色死亡"

  - name: "所有怪物死亡测试"
    description: "测试所有怪物都死亡时的战斗结束判定"
    category: "integration"
    priority: "high"
    setup:
      - "创建一个角色，攻击力=20"
      - "创建2个怪物，HP=1"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "角色攻击怪物1"
        expected: "怪物1死亡"
      - action: "角色攻击怪物2"
        expected: "怪物2死亡，战斗应该结束（胜利）"
    assertions:
      - type: "equals"
        target: "monster_1.hp"
        expected: "0"
        message: "怪物1应该死亡"
      - type: "equals"
        target: "monster_2.hp"
        expected: "0"
        message: "怪物2应该死亡"
      - type: "equals"
        target: "battle_state"
        expected: "victory"
        message: "所有怪物死亡时战斗应该判定为胜利"
      - type: "equals"
        target: "all_enemies_defeated"
        expected: "true"
        message: "应该标记为所有敌人被击败"




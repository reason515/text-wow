# 战斗系统 - 技能战斗测试
test_suite: "战斗系统 - 技能战斗"
description: "测试战斗中使用技能的各种场景，包括技能伤害、冷却、资源消耗等"

tests:
  - name: "战斗中使用技能测试"
    description: "测试在战斗中使用技能造成伤害"
    category: "integration"
    priority: "high"
    setup:
      - "创建一个战士角色，怒气=100/100，攻击力=20"
      - "创建一个消耗30点怒气，造成150%攻击力伤害的技能"
      - "创建一个防御力=10的怪物，HP=100"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "角色使用技能攻击怪物"
        expected: "技能造成伤害，角色怒气减少30点"
    assertions:
      - type: "greater_than"
        target: "skill_damage_dealt"
        expected: "15"
        message: "技能伤害应该大于普通攻击（考虑防御减伤后约18）"
      - type: "equals"
        target: "character.resource"
        expected: "70"
        message: "使用技能后怒气应该为70"
      - type: "less_than"
        target: "monster.hp"
        expected: "100"
        message: "怪物HP应该减少"

  - name: "技能冷却时间测试"
    description: "测试技能在战斗中的冷却机制"
    category: "integration"
    priority: "high"
    setup:
      - "创建一个角色，怒气=100/100"
      - "创建一个冷却时间为2回合的技能"
      - "创建一个怪物，HP=200"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "角色使用技能（第1回合）"
        expected: "技能可以使用"
      - action: "执行一个回合"
        expected: "技能进入冷却"
      - action: "角色尝试使用技能（第2回合）"
        expected: "技能在冷却中，无法使用"
      - action: "执行一个回合"
        expected: "技能冷却减少1回合"
      - action: "执行一个回合"
        expected: "技能冷却结束，可以再次使用"
    assertions:
      - type: "equals"
        target: "skill_cooldown_round_1"
        expected: "2"
        message: "第1回合后技能冷却应该为2"
      - type: "equals"
        target: "skill_cooldown_round_2"
        expected: "1"
        message: "第2回合后技能冷却应该为1"
      - type: "equals"
        target: "skill_cooldown_round_3"
        expected: "0"
        message: "第3回合后技能冷却应该为0，可以再次使用"

  - name: "技能资源不足测试"
    description: "测试资源不足时无法使用技能"
    category: "unit"
    priority: "medium"
    setup:
      - "创建一个战士角色，怒气=20/100"
      - "创建一个消耗30点怒气的技能"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "角色尝试使用技能"
        expected: "资源不足，技能无法使用"
    assertions:
      - type: "equals"
        target: "skill_use_failed"
        expected: "true"
        message: "技能使用应该失败"
      - type: "equals"
        target: "character.resource"
        expected: "20"
        message: "怒气应该保持不变"

  - name: "技能暴击测试"
    description: "测试技能可以触发暴击"
    category: "unit"
    priority: "medium"
    setup:
      - "创建一个角色，攻击力=20，物理暴击率=100%，物理暴击伤害=150%"
      - "创建一个造成150%攻击力伤害的技能"
      - "创建一个防御力=10的怪物"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "角色使用技能攻击怪物（必定暴击）"
        expected: "技能造成暴击伤害"
    assertions:
      - type: "equals"
        target: "skill_is_crit"
        expected: "true"
        message: "技能应该触发暴击"
      - type: "greater_than"
        target: "skill_crit_damage"
        expected: "25"
        message: "技能暴击伤害应该大于25（考虑防御减伤后约27）"

  - name: "技能闪避测试"
    description: "测试技能可以被闪避"
    category: "unit"
    priority: "medium"
    setup:
      - "创建一个角色，攻击力=20"
      - "创建一个技能"
      - "创建一个闪避率=100%的怪物"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "角色使用技能攻击怪物"
        expected: "技能被闪避，不造成伤害"
    assertions:
      - type: "equals"
        target: "skill_is_dodged"
        expected: "true"
        message: "技能应该被闪避"
      - type: "equals"
        target: "skill_damage_dealt"
        expected: "0"
        message: "被闪避的技能不造成伤害"


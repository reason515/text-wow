# 战斗系统 - 护盾系统测试
test_suite: "战斗系统 - 护盾系统"
description: "测试战斗中的护盾机制，包括护盾吸收伤害、持续时间、叠加等"

tests:
  - name: "基础护盾吸收伤害测试"
    description: "测试护盾吸收伤害的基本机制"
    category: "integration"
    priority: "high"
    setup:
      - "创建一个角色，HP=100/100"
      - "给角色添加50点护盾"
      - "创建一个怪物，攻击力=30"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "怪物攻击角色"
        expected: "护盾吸收30点伤害，角色HP不变"
    assertions:
      - type: "equals"
        target: "character.hp"
        expected: "100"
        message: "护盾吸收伤害后，角色HP应该不变"
      - type: "equals"
        target: "character.shield"
        expected: "20"
        message: "护盾应该剩余20点（50-30）"
      - type: "equals"
        target: "shield_damage_absorbed"
        expected: "30"
        message: "护盾应该吸收了30点伤害"

  - name: "护盾被击破测试"
    description: "测试护盾被完全击破的情况"
    category: "integration"
    priority: "high"
    setup:
      - "创建一个角色，HP=100/100"
      - "给角色添加30点护盾"
      - "创建一个怪物，攻击力=50"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "怪物攻击角色"
        expected: "护盾被击破，角色受到20点伤害"
    assertions:
      - type: "equals"
        target: "character.shield"
        expected: "0"
        message: "护盾应该被完全击破"
      - type: "equals"
        target: "character.hp"
        expected: "80"
        message: "角色HP应该减少20点（50-30）"
      - type: "equals"
        target: "shield_damage_absorbed"
        expected: "30"
        message: "护盾应该吸收了30点伤害"
      - type: "equals"
        target: "damage_dealt_to_hp"
        expected: "20"
        message: "角色实际受到20点HP伤害"

  - name: "护盾持续时间测试"
    description: "测试护盾的持续时间机制"
    category: "integration"
    priority: "high"
    setup:
      - "创建一个角色，HP=100/100"
      - "给角色添加50点护盾（持续3回合）"
      - "创建一个怪物，攻击力=20"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "执行第1回合"
        expected: "护盾持续，剩余2回合"
      - action: "执行第2回合"
        expected: "护盾持续，剩余1回合"
      - action: "执行第3回合"
        expected: "护盾持续，剩余0回合"
      - action: "执行第4回合"
        expected: "护盾消失"
    assertions:
      - type: "equals"
        target: "character.shield_duration_round_1"
        expected: "3"
        message: "第1回合护盾持续时间应该为3"
      - type: "equals"
        target: "character.shield_duration_round_2"
        expected: "2"
        message: "第2回合护盾持续时间应该为2"
      - type: "equals"
        target: "character.shield_duration_round_3"
        expected: "1"
        message: "第3回合护盾持续时间应该为1"
      - type: "equals"
        target: "character.shield"
        expected: "0"
        message: "第4回合护盾应该消失"

  - name: "护盾叠加测试"
    description: "测试多个护盾叠加的情况"
    category: "integration"
    priority: "medium"
    setup:
      - "创建一个角色，HP=100/100"
      - "给角色添加30点护盾"
      - "给角色添加20点护盾"
      - "创建一个怪物，攻击力=40"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "怪物攻击角色"
        expected: "护盾吸收40点伤害，剩余10点护盾"
    assertions:
      - type: "equals"
        target: "character.shield"
        expected: "10"
        message: "叠加后的护盾应该剩余10点（50-40）"
      - type: "equals"
        target: "character.hp"
        expected: "100"
        message: "护盾完全吸收伤害，角色HP不变"
      - type: "equals"
        target: "shield_total"
        expected: "50"
        message: "护盾总量应该为50（30+20）"

  - name: "护盾上限测试"
    description: "测试护盾是否有上限"
    category: "integration"
    priority: "medium"
    setup:
      - "创建一个角色，HP=100/100，最大护盾=100"
      - "给角色添加50点护盾"
      - "给角色添加60点护盾"
      - "初始化战斗系统"
    steps:
      - action: "检查护盾值"
        expected: "护盾应该不超过上限100"
    assertions:
      - type: "less_than_or_equal"
        target: "character.shield"
        expected: "100"
        message: "护盾应该不超过上限100"
      - type: "equals"
        target: "character.shield"
        expected: "100"
        message: "护盾应该等于上限100（50+60超过上限，取上限）"

  - name: "护盾与治疗交互测试"
    description: "测试护盾存在时治疗的交互"
    category: "integration"
    priority: "medium"
    setup:
      - "创建一个角色，HP=80/100"
      - "给角色添加30点护盾"
      - "创建一个治疗技能，恢复50点HP"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "角色使用治疗技能"
        expected: "角色HP恢复，护盾不受影响"
    assertions:
      - type: "equals"
        target: "character.hp"
        expected: "100"
        message: "治疗应该恢复HP到最大值"
      - type: "equals"
        target: "character.shield"
        expected: "30"
        message: "护盾应该不受治疗影响"

  - name: "护盾与Buff交互测试"
    description: "测试护盾与防御Buff的交互"
    category: "integration"
    priority: "low"
    setup:
      - "创建一个角色，HP=100/100，防御力=10"
      - "给角色添加50点护盾"
      - "给角色添加防御力+50%的Buff"
      - "创建一个怪物，攻击力=30"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "怪物攻击角色"
        expected: "护盾先吸收伤害，然后计算防御减伤"
    assertions:
      - type: "greater_than"
        target: "character.shield"
        expected: "0"
        message: "护盾应该吸收部分伤害"
      - type: "equals"
        target: "character.hp"
        expected: "100"
        message: "如果护盾足够，角色HP应该不变"

  - name: "护盾技能测试"
    description: "测试使用技能获得护盾"
    category: "integration"
    priority: "high"
    setup:
      - "创建一个角色，HP=100/100，怒气=100/100"
      - "创建一个护盾技能，提供60点护盾（持续3回合），消耗40点怒气"
      - "创建一个怪物，攻击力=30"
      - "初始化战斗系统"
    steps:
      - action: "开始战斗"
        expected: "战斗状态为进行中"
      - action: "角色使用护盾技能"
        expected: "角色获得60点护盾，怒气减少40点"
      - action: "怪物攻击角色"
        expected: "护盾吸收30点伤害"
    assertions:
      - type: "equals"
        target: "character.shield"
        expected: "60"
        message: "使用技能后应该获得60点护盾"
      - type: "equals"
        target: "character.resource"
        expected: "60"
        message: "使用技能后怒气应该为60"
      - type: "equals"
        target: "character.shield"
        expected: "30"
        message: "受到攻击后护盾应该剩余30点"


















































# 技能系统设计文档

> 📌 **核心设计理念**: 丰富的技能类型，清晰的冷却机制，灵活的Buff/Debuff系统，支持技能升级和配置化

---

## 📋 目录

1. [系统概览](#系统概览)
2. [技能分类](#技能分类)
3. [技能获取机制](#技能获取机制)
4. [技能升级系统](#技能升级系统)
5. [冷却机制](#冷却机制)
6. [Buff/Debuff系统](#buffdebuff系统)
7. [被动技能系统](#被动技能系统)
8. [配置化设计](#配置化设计)

---

## 系统概览

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          技能系统架构                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   技能学习 ──→ 技能升级 ──→ 技能使用 ──→ 冷却管理 ──→ 效果应用              │
│      │            │            │            │            │                 │
│   选择技能    提升等级    消耗资源    倒计时       Buff/Debuff              │
│                                                                             │
│   技能类型:                                                                  │
│   ├─ 攻击技能: 造成伤害                                                     │
│   ├─ 治疗技能: 恢复生命                                                     │
│   ├─ Buff技能: 提供增益                                                     │
│   ├─ Debuff技能: 施加减益                                                   │
│   ├─ 控制技能: 控制敌人                                                     │
│   └─ 被动技能: 持续效果                                                     │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 技能分类

### 1. 攻击技能 (Attack)

**特点**:
- 造成伤害（物理/法术/元素）
- 消耗资源（怒气/法力/能量）
- 可能有冷却时间

**示例**:
- 英勇打击: 物理攻击，消耗怒气
- 火球术: 火焰伤害，消耗法力
- 背刺: 物理攻击，消耗能量

### 2. 治疗技能 (Heal)

**特点**:
- 恢复生命值
- 可能治疗自己或队友
- 消耗资源

**示例**:
- 治疗术: 恢复目标生命值
- 群体治疗: 恢复所有队友生命值
- 持续治疗: HOT效果

### 3. Buff技能 (Buff)

**特点**:
- 提供增益效果
- 持续一定回合数
- 可能叠加

**示例**:
- 战斗怒吼: 提升攻击力
- 护盾: 吸收伤害
- 加速: 提升行动速度

### 4. Debuff技能 (Debuff)

**特点**:
- 施加减益效果
- 持续一定回合数
- 可能叠加

**示例**:
- 撕裂: 持续物理伤害
- 减速: 降低行动速度
- 虚弱: 降低攻击力

### 5. 控制技能 (Control)

**特点**:
- 控制敌人行动
- 可能有持续时间
- 消耗资源

**示例**:
- 眩晕: 无法行动
- 沉默: 无法使用技能
- 嘲讽: 强制攻击自己

### 6. DOT技能 (Damage Over Time)

**特点**:
- 持续造成伤害
- 每回合触发
- 持续一定回合数

**示例**:
- 毒药: 持续自然伤害
- 燃烧: 持续火焰伤害
- 暗影腐蚀: 持续暗影伤害

### 7. HOT技能 (Heal Over Time)

**特点**:
- 持续恢复生命值
- 每回合触发
- 持续一定回合数

**示例**:
- 恢复: 持续恢复生命值
- 自然愈合: 持续恢复生命值

### 8. 被动技能 (Passive)

**特点**:
- 持续生效
- 不需要主动使用
- 提供属性加成或特殊效果

**示例**:
- 武器精通: 提升武器伤害
- 护甲精通: 提升护甲值
- 战斗反射: 受击时反击

---

## 技能获取机制

### 获取时机

#### 1. 角色创建时（1级）

- **类型**: 主动技能
- **数量**: 从初始技能池中选择2个
- **等级**: 1级

#### 2. 等级达到3的倍数时（3, 6, 9, 12...）

- **类型**: 被动技能选择机会
- **选择**: 强化现有被动技能 或 选择新被动技能

#### 3. 等级达到5的倍数时（5, 10, 15, 20...）

- **类型**: 主动技能选择机会
- **选择**: 强化现有主动技能 或 选择新主动技能

### 选择机制

#### 选项1: 强化现有技能

- 从已学会的技能中选择1个
- 技能等级提升1级
- 如果技能已达到最大等级（5级），则无法选择

#### 选项2: 选择新技能

- 系统随机从对应技能池中抽取4个技能
- 从这4个技能中选择1个
- 获得该技能，等级为1

### 技能池

#### 初始技能池

- 包含9个基础主动技能
- 创建角色时从这些技能中选择2个

#### 主动技能池

- 所有主动技能都在同一个池子中
- 5级开始就能随机到所有主动技能

#### 被动技能池

- 所有被动技能都在同一个池子中
- 3级开始就能随机到所有被动技能

---

## 技能升级系统

### 升级机制

- **第1次选择**: 获得技能，等级为1
- **强化1次**: 技能等级提升到2，效果提升
- **强化2次**: 技能等级提升到3，效果提升
- **强化3次**: 技能等级提升到4，效果提升
- **强化4次**: 技能等级提升到5，效果提升（最大等级）

### 升级效果

#### 伤害技能

```
1级: 基础伤害 × 100%
2级: 基础伤害 × 115%
3级: 基础伤害 × 130%
4级: 基础伤害 × 145%
5级: 基础伤害 × 160%
```

#### 治疗技能

```
1级: 基础治疗 × 100%
2级: 基础治疗 × 115%
3级: 基础治疗 × 130%
4级: 基础治疗 × 145%
5级: 基础治疗 × 160%
```

#### 冷却技能

```
1级: 基础冷却时间
2级: 冷却时间 - 0.5回合
3级: 冷却时间 - 1回合
4级: 冷却时间 - 1.5回合
5级: 冷却时间 - 2回合
```

---

## 冷却机制

### 冷却时间

- **单位**: 回合数
- **计算**: 技能使用后进入冷却，每回合减少1
- **冷却完成**: 冷却时间归零时可以使用

### 冷却规则

#### 1. 独立冷却

- 每个技能有独立的冷却时间
- 不同技能的冷却互不影响

#### 2. 冷却减少

- 技能升级可以减少冷却时间
- 装备或Buff可以提供冷却减少

#### 3. 冷却重置

- 某些技能可以重置其他技能的冷却
- 某些Buff可以重置技能冷却

### 冷却状态

```go
type SkillCooldownState struct {
    SkillID      string
    CooldownLeft int  // 剩余冷却时间（回合数）
    IsReady      bool // 是否可以使用
}
```

---

## Buff/Debuff系统

### 效果类型

#### 1. 属性加成 (Stat Modifier)

- **力量/敏捷/智力/耐力/精神**: 增加或减少属性
- **攻击力/防御力**: 增加或减少攻击或防御
- **暴击率/闪避率**: 增加或减少暴击或闪避

#### 2. 伤害加成 (Damage Modifier)

- **伤害增加**: 增加造成的伤害
- **伤害减少**: 减少受到的伤害
- **元素伤害**: 增加特定元素伤害

#### 3. 持续伤害/治疗 (DOT/HOT)

- **DOT**: 每回合造成伤害
- **HOT**: 每回合恢复生命值

#### 4. 控制效果 (Control)

- **眩晕**: 无法行动
- **沉默**: 无法使用技能
- **减速**: 降低行动速度

#### 5. 护盾 (Shield)

- **吸收伤害**: 优先吸收伤害，直到护盾值归零

### 效果属性

```go
type BuffDebuff struct {
    ID          string
    Name        string
    Type        string      // buff/debuff
    EffectType  string      // stat_mod/dot/hot/shield/control
    Duration    int         // 持续回合数
    Value       float64     // 效果数值
    StatAffected string     // 影响的属性
    IsStackable bool        // 是否可叠加
    MaxStacks   int         // 最大叠加层数
    CurrentStacks int       // 当前叠加层数
}
```

### 效果叠加

#### 不可叠加

- 相同ID的效果不能叠加
- 新效果替换旧效果

#### 可叠加

- 相同ID的效果可以叠加
- 叠加层数有上限
- 每层效果独立计算

### 效果持续时间

- **回合倒计时**: 每回合减少1
- **持续时间归零**: 效果自动移除
- **持续时间刷新**: 某些技能可以刷新持续时间

---

## 被动技能系统

### 被动技能类型

#### 1. 属性加成

- **力量精通**: 每级+2力量
- **敏捷精通**: 每级+2敏捷
- **智力精通**: 每级+2智力

#### 2. 伤害加成

- **物理伤害提升**: 每级+5%物理伤害
- **法术伤害提升**: 每级+5%法术伤害

#### 3. 防御加成

- **护甲精通**: 每级+5%护甲值
- **抗性提升**: 每级+5%元素抗性

#### 4. 特殊效果

- **战斗反射**: 受击时有概率反击
- **致命一击**: 暴击时有额外效果
- **生命恢复**: 每回合恢复生命值

### 被动技能升级

- **等级提升**: 每级效果增强
- **最大等级**: 通常为5级
- **升级方式**: 在被动技能选择机会时选择强化

---

## 配置化设计

### 技能配置表

```sql
-- 技能配置表
CREATE TABLE skills (
    id VARCHAR(32) PRIMARY KEY,
    name VARCHAR(32) NOT NULL,
    description TEXT,
    class_id VARCHAR(32),
    type VARCHAR(16) NOT NULL,  -- attack/heal/buff/debuff/control/dot/hot/passive
    target_type VARCHAR(16) NOT NULL,  -- self/ally/enemy/ally_all/enemy_all
    damage_type VARCHAR(16),  -- physical/magic/fire/frost/shadow/holy/nature
    base_value INTEGER DEFAULT 0,  -- 基础数值
    scaling_stat VARCHAR(16),  -- 成长属性
    scaling_ratio REAL DEFAULT 1.0,  -- 属性加成系数
    resource_cost INTEGER DEFAULT 0,  -- 资源消耗
    cooldown INTEGER DEFAULT 0,  -- 冷却时间（回合数）
    level_required INTEGER DEFAULT 1,  -- 需求等级
    max_level INTEGER DEFAULT 5,  -- 最大等级
    threat_modifier REAL DEFAULT 1.0,  -- 仇恨系数
    threat_type VARCHAR(16) DEFAULT 'normal',  -- 仇恨类型
    tags TEXT,  -- JSON数组，标签
    effect_id VARCHAR(32),  -- 附加效果ID
    FOREIGN KEY (class_id) REFERENCES classes(id),
    FOREIGN KEY (effect_id) REFERENCES effects(id)
);
```

### 效果配置表

```sql
-- 效果配置表（Buff/Debuff）
CREATE TABLE effects (
    id VARCHAR(32) PRIMARY KEY,
    name VARCHAR(32) NOT NULL,
    description TEXT,
    type VARCHAR(16) NOT NULL,  -- stat_mod/dot/hot/shield/control
    is_buff INTEGER NOT NULL,  -- 1=增益 0=减益
    is_stackable INTEGER DEFAULT 0,  -- 是否可叠加
    max_stacks INTEGER DEFAULT 1,  -- 最大叠加层数
    duration INTEGER NOT NULL,  -- 持续回合数
    tick_interval INTEGER DEFAULT 1,  -- 触发间隔
    value REAL DEFAULT 0,  -- 效果数值
    stat_affected VARCHAR(16),  -- 影响的属性
    FOREIGN KEY (stat_affected) REFERENCES attributes(id)
);
```

### 配置管理

- **热更新**: 修改配置表后，通过ConfigManager重新加载
- **版本管理**: 配置变更记录版本，支持回滚
- **平衡调整**: 修改配置表即可调整技能强度

---

## 技能使用流程

```
1. 检查技能可用性
   ├─ 技能是否已学会
   ├─ 冷却时间是否完成
   ├─ 资源是否足够
   └─ 目标是否有效

2. 消耗资源
   ├─ 扣除资源（怒气/法力/能量）
   └─ 更新资源状态

3. 执行技能效果
   ├─ 计算伤害/治疗
   ├─ 应用Buff/Debuff
   └─ 触发特殊效果

4. 进入冷却
   ├─ 设置冷却时间
   └─ 更新冷却状态

5. 记录使用
   ├─ 更新技能使用统计
   └─ 记录战斗日志
```

---

## 总结

### 设计亮点

1. **丰富的技能类型**: 攻击、治疗、Buff、Debuff、控制等
2. **灵活的获取机制**: 可以选择强化或学习新技能
3. **清晰的升级系统**: 技能等级提升带来效果增强
4. **完善的冷却机制**: 平衡技能使用频率
5. **强大的Buff/Debuff系统**: 提供丰富的战术选择

### 后续扩展

- [ ] 技能连击系统
- [ ] 技能组合效果
- [ ] 技能符文系统
- [ ] 技能天赋树

---

**文档版本**: v1.0  
**最后更新**: 2025年



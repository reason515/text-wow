# 游戏机制设计文档

本文档描述适用于所有职业的通用游戏机制。

---

## 📊 属性系统设计

### 属性职责总览

| 属性 | 主要作用 | 对应职业 |
|------|---------|---------|
| **力量** | 物理攻击（主）、物理防御（副）、物理暴击伤害 | 战士、圣骑士 |
| **敏捷** | 物理攻击（副）、物理暴击率、闪避 | 盗贼、猎人 |
| **智力** | 魔法攻击（主）、魔法防御（副）、法术暴击伤害 | 法师、术士 |
| **精神** | 魔法攻击（副）、魔法防御（副）、法术暴击率、最大MP、法力回复 | 牧师、治疗职业 |
| **耐力** | 最大HP（主）、物理防御（副） | 所有职业（尤其坦克） |

### 攻击力公式

```
物理攻击 = 力量×1.0 + 敏捷×0.2
魔法攻击 = 智力×1.0 + 精神×0.2
```

**示例：**
- 战士（力量12，敏捷8）：12×1.0 + 8×0.2 = **14** 物理攻击
- 法师（智力14，精神10）：14×1.0 + 10×0.2 = **16** 魔法攻击

### 防御力公式

```
物理防御 = 力量×0.2 + 耐力×0.3
魔法防御 = 智力×0.2 + 精神×0.3
```

**示例：**
- 战士（力量12，耐力10）：12×0.2 + 10×0.3 = **5** 物理防御
- 法师（智力14，精神10）：14×0.2 + 10×0.3 = **6** 魔法防御

### HP/MP公式

```
最大HP = 职业基础HP + 耐力×2
最大MP = 职业基础MP + 精神×2（法力职业）
怒气/能量 = 固定值（不受属性影响）
```

**示例：**
- 战士（基础HP 35，耐力10）：35 + 10×2 = **55** HP
- 法师（基础MP 40，精神10）：40 + 10×2 = **60** MP

---

## 💥 暴击系统设计

### 设计原则

暴击系统区分**物理暴击**和**法术暴击**，分别由不同的属性影响：

| 暴击类型 | 影响属性 | 适用场景 |
|---------|---------|---------|
| **物理暴击率** | 敏捷 | 物理攻击、物理技能 |
| **物理暴击伤害** | 力量 | 物理攻击、物理技能 |
| **法术暴击率** | 精神 | 法术攻击、法术技能 |
| **法术暴击伤害** | 智力 | 法术攻击、法术技能 |

### 暴击率公式

```
物理暴击率 = 基础5% + 敏捷/20 + 装备加成 + 被动技能加成 + Buff加成
法术暴击率 = 基础5% + 精神/20 + 装备加成 + 被动技能加成 + Buff加成

暴击率上限：100%
```

**示例计算：**
- 战士（敏捷40）：5% + 40/20 = 5% + 2% = 7% 物理暴击率
- 盗贼（敏捷100）：5% + 100/20 = 5% + 5% = 10% 物理暴击率
- 牧师（精神100）：5% + 100/20 = 5% + 5% = 10% 法术暴击率
- 法师（精神60）：5% + 60/20 = 5% + 3% = 8% 法术暴击率

### 暴击伤害公式

```
物理暴击伤害 = 150% + 力量×0.3% + 装备加成 + 被动技能加成
法术暴击伤害 = 150% + 智力×0.3% + 装备加成 + 被动技能加成

暴击伤害上限：300%
```

**示例计算：**
- 战士（力量100）：150% + 100×0.3% = 150% + 30% = **180%** 暴击伤害
- 盗贼（力量50）：150% + 50×0.3% = 150% + 15% = **165%** 暴击伤害
- 法师（智力150）：150% + 150×0.3% = 150% + 45% = **195%** 法术暴击伤害

### 职业暴击定位

| 职业 | 主属性 | 暴击类型 | 暴击倾向 |
|-----|-------|---------|---------|
| 战士 | 力量 | 物理 | 低暴击率，高暴击伤害 |
| 盗贼 | 敏捷 | 物理 | 高暴击率，中暴击伤害 |
| 猎人 | 敏捷 | 物理 | 高暴击率，中暴击伤害 |
| 法师 | 智力 | 法术 | 中暴击率，高暴击伤害 |
| 术士 | 智力 | 法术 | 中暴击率，中暴击伤害 |
| 牧师 | 智力/精神 | 法术 | 高暴击率（精神高），中暴击伤害 |
| 圣骑士 | 力量/智力 | 混合 | 中暴击率，中暴击伤害 |
| 德鲁伊 | 智力/敏捷 | 混合 | 根据形态变化 |
| 萨满 | 智力/精神 | 法术 | 中暴击率，中暴击伤害 |

### 角色属性字段

```go
type Character struct {
    // ... 其他属性 ...
    
    // 暴击属性（区分物理和法术）
    PhysCritRate    float64 `json:"physCritRate"`    // 物理暴击率
    PhysCritDamage  float64 `json:"physCritDamage"`  // 物理暴击伤害
    SpellCritRate   float64 `json:"spellCritRate"`   // 法术暴击率
    SpellCritDamage float64 `json:"spellCritDamage"` // 法术暴击伤害
}
```

### 战斗系统应用

1. **根据伤害类型选择暴击率**：
   - `damage_type = "physical"` → 使用 `PhysCritRate`
   - `damage_type = "magic/fire/frost/shadow/holy/nature"` → 使用 `SpellCritRate`

2. **暴击判定流程**：
   ```
   1. 获取基础暴击率（根据伤害类型）
   2. 应用被动技能加成
   3. 应用Buff加成
   4. 生成随机数 [0, 1)
   5. 如果随机数 < 实际暴击率，则暴击
   6. 暴击时：最终伤害 = 基础伤害 × 暴击伤害倍率
   ```

---

## 🛡️ 伤害计算系统

### 伤害公式

```
基础伤害 = 攻击力 × 技能系数
减伤后伤害 = 基础伤害 × (1 - 防御减伤)
最终伤害 = 减伤后伤害 × (暴击? 暴击伤害倍率 : 1)
```

### 防御减伤公式

```
物理减伤 = 物理防御 / (物理防御 + 100)
魔法减伤 = 魔法防御 / (魔法防御 + 100)

减伤上限：75%
```

**示例：**
- 物理防御100：100/(100+100) = 50% 减伤
- 魔法防御50：50/(50+100) = 33% 减伤

---

## 🎯 仇恨系统

### 基本原理

仇恨值决定怪物攻击目标，仇恨最高的玩家成为攻击目标。

### 仇恨获取

```
基础仇恨 = 伤害量 × 仇恨系数
治疗仇恨 = 治疗量 × 0.5（分摊给所有敌人）
```

### 仇恨系数

| 技能类型 | 系数 | 说明 |
|---------|------|------|
| 普通攻击 | 1.0 | 基础仇恨 |
| 坦克技能 | 1.2-3.0 | 高仇恨 |
| DPS技能 | 0.8-1.0 | 中等仇恨 |
| 治疗技能 | 0.5 | 低仇恨 |
| 嘲讽 | 特殊 | 强制成为第一仇恨 |

---

## 📦 装备系统

### 装备词缀（暴击相关）

| 词缀 | 效果 | 适用装备 |
|-----|------|---------|
| of 暴击 | +3-8% 物理暴击率 | 武器 |
| of 致命 | +10-25% 暴击伤害 | 武器 |
| of 法术暴击 | +3-8% 法术暴击率 | 武器/饰品 |
| of 法术致命 | +10-25% 法术暴击伤害 | 武器/饰品 |

---

## 🔄 回合制战斗

### 战斗流程

1. **玩家回合**：选择技能/攻击
2. **技能执行**：计算伤害、应用效果
3. **敌人回合**：根据仇恨选择目标
4. **回合结束**：Buff/Debuff 倒计时、DOT伤害

### 资源系统

| 资源类型 | 获取方式 | 消耗方式 |
|---------|---------|---------|
| 怒气 | 攻击/受击获得 | 技能消耗 |
| 法力 | 回合恢复 | 技能消耗 |
| 能量 | 回合恢复（快） | 技能消耗 |


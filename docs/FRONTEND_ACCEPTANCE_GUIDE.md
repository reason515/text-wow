# 前端集成验收指南

> 📋 **目的**: 在开始Phase 3之前，验证Phase 1和Phase 2的后端改动是否与前端兼容，确保前端功能正常工作。

---

## 📊 验收概览

### 本次验收范围

**Phase 1: 属性计算系统**
- ✅ 物理攻击力计算（力量×0.4 + 敏捷×0.2）
- ✅ 法术攻击力计算（智力×1.0 + 精神×0.2）
- ✅ 最大生命值计算（职业基础HP + 耐力×2）
- ✅ 物理暴击率计算（5% + 敏捷/20，上限50%）
- ✅ 法术暴击率计算（5% + 精神/20，上限50%）
- ✅ 闪避率计算（5% + 敏捷/20，上限50%）
- ✅ 物理暴击伤害倍率计算（150% + 力量×0.3%）
- ✅ 速度计算（速度 = 敏捷）

**Phase 2: 技能系统**
- ✅ 技能使用和伤害计算
- ✅ 技能资源消耗
- ✅ AOE技能支持
- ✅ 治疗技能支持
- ✅ Buff/Debuff技能支持

---

## 🔍 验收关注点

### 1. 角色属性显示 ✅ **高优先级**

#### 1.1 角色详情面板属性显示

**位置**: `client/src/components/GameScreen.vue` (约2068-2133行)

**需要验证**:
- [ ] 物理攻击力 (`physicalAttack`) 显示正确
- [ ] 法术攻击力 (`magicAttack`) 显示正确
- [ ] 物理暴击率 (`physCritRate`) 显示为百分比，格式正确（如 "6.5%"）
- [ ] 物理暴击伤害 (`physCritDamage`) 显示为百分比，格式正确（如 "165%"）
- [ ] 法术暴击率 (`spellCritRate`) 显示为百分比，格式正确
- [ ] 法术暴击伤害 (`spellCritDamage`) 显示为百分比，格式正确
- [ ] 闪避率 (`dodgeRate`) 显示为百分比，格式正确（如 "6.5%"）

**验证方法**:
1. 登录游戏，创建或选择一个角色
2. 打开角色详情面板
3. 检查所有属性值是否显示
4. 检查百分比格式是否正确（应该显示为 "X.X%" 或 "XXX%"）

**预期行为**:
- 所有计算属性都应该有值（不应该为0或undefined）
- 百分比应该正确格式化（0.065 显示为 "6.5%"）
- 属性值应该符合计算公式

#### 1.2 属性Tooltip说明

**位置**: `client/src/components/GameScreen.vue` (约667行附近，`getPrimaryStatTooltip`函数)

**需要验证**:
- [ ] 敏捷Tooltip包含速度说明（"速度 = 敏捷"）
- [ ] 敏捷Tooltip显示物理暴击率计算公式
- [ ] 敏捷Tooltip显示闪避率计算公式
- [ ] 力量Tooltip显示物理攻击力计算公式
- [ ] 智力Tooltip显示法术攻击力计算公式
- [ ] 精神Tooltip显示法术暴击率计算公式

**验证方法**:
1. 在角色详情面板中，将鼠标悬停在各个主属性上
2. 检查Tooltip是否显示正确的计算公式
3. 检查Tooltip是否包含当前属性值的贡献

**预期行为**:
- Tooltip应该清晰说明每个主属性如何影响派生属性
- 应该显示当前属性值的具体贡献（如 "当前贡献: +4.8"）

---

### 2. 战斗系统功能 ✅ **高优先级**

#### 2.1 战斗伤害计算

**需要验证**:
- [ ] 物理伤害计算正确（攻击力 - 防御力，最低1点）
- [ ] 暴击伤害正确应用（基础伤害 × 暴击伤害倍率）
- [ ] 闪避判定正常工作（被闪避时伤害为0）
- [ ] 战斗日志正确显示伤害数值
- [ ] 战斗日志正确显示暴击信息（如 "暴击！"）
- [ ] 战斗日志正确显示闪避信息（如 "闪避！"）

**验证方法**:
1. 开始战斗
2. 观察战斗日志中的伤害数值
3. 检查是否有暴击和闪避的提示
4. 验证伤害数值是否符合计算公式

**预期行为**:
- 伤害数值应该合理（不应该出现异常大的数值）
- 暴击时伤害应该明显高于普通攻击
- 闪避时应该显示 "闪避" 或类似提示，伤害为0

#### 2.2 技能使用

**需要验证**:
- [ ] 技能可以正常使用
- [ ] 技能资源消耗正确（使用技能后资源减少）
- [ ] 技能伤害计算正确（考虑技能倍率）
- [ ] AOE技能对多个敌人造成伤害
- [ ] 治疗技能正确恢复HP
- [ ] Buff技能正确应用效果

**验证方法**:
1. 在战斗中使用各种类型的技能
2. 观察资源消耗
3. 观察伤害/治疗效果
4. 检查Buff是否出现在角色状态中

**预期行为**:
- 技能使用后资源应该正确减少
- 技能伤害应该考虑技能倍率（如150%倍率应该造成更高伤害）
- AOE技能应该对所有敌人造成伤害
- 治疗技能应该恢复HP，但不能超过最大HP
- Buff应该显示在角色状态中，并有持续时间

---

### 3. API兼容性 ✅ **中优先级**

#### 3.1 角色数据API

**API端点**: `GET /api/character`

**需要验证**:
- [ ] API返回的角色数据包含所有计算属性
- [ ] 属性值类型正确（数字类型，不是字符串）
- [ ] 百分比属性值在0-1之间（如0.065表示6.5%）
- [ ] API响应时间正常（不应该有明显延迟）

**验证方法**:
1. 打开浏览器开发者工具（F12）
2. 切换到 Network 标签
3. 刷新游戏页面或执行相关操作
4. 查看 `/api/character` 请求的响应
5. 检查响应数据格式

**预期响应格式**:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "name": "角色名",
    "physicalAttack": 10,
    "magicAttack": 17,
    "physCritRate": 0.065,
    "physCritDamage": 1.65,
    "spellCritRate": 0.07,
    "spellCritDamage": 1.5,
    "dodgeRate": 0.065,
    // ... 其他属性
  }
}
```

#### 3.2 战斗状态API

**API端点**: `GET /api/battle/status`

**需要验证**:
- [ ] API返回战斗状态包含角色数据
- [ ] 角色数据包含计算后的属性
- [ ] Buff信息正确返回（如果有Buff）
- [ ] 战斗日志正确返回

**验证方法**:
1. 开始战斗
2. 在开发者工具中查看 `/api/battle/status` 请求
3. 检查响应数据

---

### 4. 数据一致性 ✅ **中优先级**

#### 4.1 属性计算一致性

**需要验证**:
- [ ] 前端显示的属性值与后端计算的属性值一致
- [ ] 不同界面显示的同一属性值一致（如角色卡片和角色详情）
- [ ] 属性值在战斗前后保持一致（除非有Buff/Debuff影响）

**验证方法**:
1. 记录角色详情面板中的属性值
2. 检查角色卡片中的属性值（如果有显示）
3. 开始战斗，检查战斗中的属性值
4. 对比这些值是否一致

**预期行为**:
- 同一属性在不同界面应该显示相同的值
- 只有在应用Buff/Debuff时，属性值才应该改变

#### 4.2 战斗伤害一致性

**需要验证**:
- [ ] 战斗日志中的伤害数值与预期计算一致
- [ ] 暴击伤害符合暴击伤害倍率
- [ ] 防御减伤正确应用

**验证方法**:
1. 记录角色的攻击力和敌人的防御力
2. 进行攻击，记录实际伤害
3. 验证：伤害 = max(1, 攻击力 - 防御力)
4. 如果触发暴击，验证：伤害 = max(1, 攻击力 - 防御力) × 暴击伤害倍率

---

### 5. 边界情况 ✅ **低优先级**

#### 5.1 极端属性值

**需要验证**:
- [ ] 极高敏捷时，暴击率和闪避率被限制在50%上限
- [ ] 极高力量时，物理攻击力正确计算
- [ ] 极高智力时，法术攻击力正确计算
- [ ] 属性为0或负数时，属性值至少为1（最小值保护）

**验证方法**:
1. 创建或修改角色，设置极端属性值
2. 检查属性计算是否正确
3. 检查是否有上限保护

#### 5.2 防御高于攻击

**需要验证**:
- [ ] 当防御力高于攻击力时，至少造成1点伤害
- [ ] 战斗日志正确显示最低伤害

**验证方法**:
1. 使用低攻击力角色攻击高防御力敌人
2. 验证伤害至少为1点

---

## 🐛 常见问题排查

### 问题1: 属性显示为0或undefined

**可能原因**:
- 后端API没有返回计算后的属性
- 前端类型定义不匹配
- 数据库中的角色数据不完整

**排查步骤**:
1. 检查浏览器控制台是否有错误
2. 检查API响应数据
3. 检查前端类型定义 (`client/src/types/game.ts`)
4. 检查后端是否在返回角色数据时计算了属性

### 问题2: 伤害数值异常

**可能原因**:
- 伤害计算公式错误
- 属性值计算错误
- 技能倍率未正确应用

**排查步骤**:
1. 检查战斗日志中的伤害数值
2. 手动计算预期伤害
3. 对比实际伤害和预期伤害
4. 检查技能倍率是否正确应用

### 问题3: 暴击/闪避不显示

**可能原因**:
- 前端日志格式化问题
- 后端未返回暴击/闪避信息
- 暴击率/闪避率计算错误

**排查步骤**:
1. 检查战斗日志API响应
2. 检查前端日志格式化函数
3. 验证暴击率/闪避率计算是否正确

---

## ✅ 验收检查清单

### 基础功能
- [ ] 角色创建和登录正常
- [ ] 角色详情面板正常显示
- [ ] 所有属性值正确显示
- [ ] 属性Tooltip正确显示

### 战斗功能
- [ ] 战斗可以正常开始和停止
- [ ] 战斗伤害计算正确
- [ ] 暴击和闪避正常工作
- [ ] 技能可以正常使用
- [ ] 技能资源消耗正确
- [ ] 战斗日志正确显示

### API兼容性
- [ ] `/api/character` API正常返回数据
- [ ] `/api/battle/status` API正常返回数据
- [ ] API响应格式正确
- [ ] API响应时间正常

### 数据一致性
- [ ] 属性值在不同界面一致
- [ ] 伤害计算与预期一致
- [ ] 战斗前后属性值一致（无Buff时）

### 边界情况
- [ ] 极端属性值正确处理
- [ ] 防御高于攻击时至少造成1点伤害
- [ ] 暴击率/闪避率上限正确应用

---

## 📝 验收报告模板

### 验收日期
[填写日期]

### 验收人员
[填写姓名]

### 测试环境
- 后端版本: [填写版本或commit hash]
- 前端版本: [填写版本或commit hash]
- 浏览器: [填写浏览器和版本]

### 测试结果

#### 通过项
- [列出所有通过的测试项]

#### 失败项
- [列出所有失败的测试项，并说明问题]

#### 问题记录
1. **问题描述**: [描述问题]
   - **严重程度**: [高/中/低]
   - **复现步骤**: [详细步骤]
   - **预期行为**: [预期应该发生什么]
   - **实际行为**: [实际发生了什么]
   - **截图/日志**: [如有]

### 总结
[总结验收结果，说明是否需要前端适配，以及下一步行动]

---

## 🚀 下一步行动

### 如果所有测试通过
✅ 可以开始 Phase 3: 装备系统测试

### 如果发现问题
1. **高优先级问题**: 必须修复后才能继续
2. **中优先级问题**: 可以记录并在后续版本修复
3. **低优先级问题**: 可以记录并在后续优化

### 前端适配需求
如果发现需要前端适配的问题，参考 `docs/FRONTEND_INTEGRATION_GUIDE.md` 进行修改。

---

## 📚 相关文档

- [前端集成指南](./FRONTEND_INTEGRATION_GUIDE.md)
- [验证新功能](./VERIFY_NEW_FEATURES.md)
- [属性计算系统设计](./calculator_design.md)
- [技能系统设计](./skill_system_design.md)


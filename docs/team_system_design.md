# 队伍系统设计文档

> 📌 **核心设计理念**: 从单角色扩展到最多5人小队，支持角色搭配和协同作战

---

## 📋 目录

1. [系统概览](#系统概览)
2. [队伍管理](#队伍管理)
3. [角色槽位系统](#角色槽位系统)
4. [队伍搭配系统](#队伍搭配系统)
5. [队伍协同技能](#队伍协同技能)
6. [队伍属性计算](#队伍属性计算)

---

## 系统概览

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          队伍系统架构                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   角色创建 ──→ 槽位管理 ──→ 队伍搭配 ──→ 协同作战 ──→ 属性加成              │
│      │            │            │            │            │                 │
│   初始1个     1-5号位     坦克+治疗+DPS   协同技能    队伍Buff             │
│                                                                             │
│   队伍规模:                                                                  │
│   ├─ 初始: 1个角色 (槽位1)                                                  │
│   ├─ 解锁: 通过任务/等级解锁新槽位                                          │
│   └─ 最大: 5个角色 (槽位1-5)                                                │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 队伍管理

### 队伍结构

```go
type Team struct {
    UserID        int
    MaxSize       int          // 最大队伍人数 (1-5)
    UnlockedSlots int          // 已解锁槽位数
    Characters    []*Character // 队伍中的角色
}
```

### 槽位解锁

| 槽位 | 解锁条件 | 说明 |
|-----|---------|------|
| 1号位 | 角色创建时 | 初始槽位 |
| 2号位 | 等级达到10级 | 解锁第二个槽位 |
| 3号位 | 等级达到20级 | 解锁第三个槽位 |
| 4号位 | 等级达到30级 | 解锁第四个槽位 |
| 5号位 | 等级达到40级 | 解锁第五个槽位 |

### 队伍操作

#### 添加角色

```
1. 检查槽位是否已解锁
2. 检查槽位是否为空
3. 创建新角色或选择已有角色
4. 将角色添加到指定槽位
```

#### 移除角色

```
1. 检查角色是否在队伍中
2. 从槽位中移除角色
3. 保留角色数据（不删除）
```

#### 交换角色

```
1. 检查两个槽位是否都有角色
2. 交换两个槽位的角色
```

---

## 角色槽位系统

### 槽位定义

| 槽位 | 位置 | 默认角色 | 说明 |
|-----|------|---------|------|
| 1号位 | 前排中央 | 坦克/战士 | 主要承受伤害 |
| 2号位 | 前排左侧 | 坦克/DPS | 辅助承受伤害 |
| 3号位 | 后排中央 | 治疗/DPS | 主要输出/治疗 |
| 4号位 | 后排左侧 | DPS/治疗 | 辅助输出/治疗 |
| 5号位 | 后排右侧 | DPS | 纯输出 |

### 槽位属性

```go
type TeamSlot struct {
    SlotNumber int    // 1-5
    Position   string // front/back
    Character  *Character
    IsActive   bool   // 是否出战
}
```

### 槽位效果

#### 前排槽位 (1-2号位)

- **承受伤害**: 优先受到敌人攻击
- **仇恨加成**: 仇恨值 × 1.2
- **防御加成**: 物理防御 + 5%

#### 后排槽位 (3-5号位)

- **承受伤害**: 较少受到敌人攻击
- **仇恨减少**: 仇恨值 × 0.8
- **输出加成**: 攻击力 + 5%

---

## 队伍搭配系统

### 角色定位

#### 1. 坦克 (Tank)

**职责**:
- 吸收伤害
- 保护队友
- 控制敌人

**推荐职业**:
- 战士
- 圣骑士
- 德鲁伊（熊形态）

**推荐槽位**: 1-2号位（前排）

#### 2. 治疗 (Healer)

**职责**:
- 恢复队友生命值
- 驱散Debuff
- 提供Buff

**推荐职业**:
- 牧师
- 德鲁伊
- 萨满
- 圣骑士

**推荐槽位**: 3-4号位（后排）

#### 3. 输出 (DPS)

**职责**:
- 造成伤害
- 快速击杀敌人
- 控制敌人

**推荐职业**:
- 法师
- 盗贼
- 猎人
- 术士

**推荐槽位**: 3-5号位（后排）

### 经典搭配

#### 搭配1: 标准队伍 (3人)

```
1号位: 战士 (坦克)
3号位: 牧师 (治疗)
5号位: 法师 (DPS)
```

#### 搭配2: 平衡队伍 (4人)

```
1号位: 战士 (坦克)
2号位: 圣骑士 (副坦克/治疗)
3号位: 牧师 (治疗)
5号位: 法师 (DPS)
```

#### 搭配3: 完整队伍 (5人)

```
1号位: 战士 (主坦克)
2号位: 圣骑士 (副坦克)
3号位: 牧师 (主治疗)
4号位: 法师 (DPS)
5号位: 盗贼 (DPS)
```

---

## 队伍协同技能

### 协同机制

#### 1. 增益协同

- **战斗怒吼**: 战士提供，全队攻击力+10%
- **智慧祝福**: 圣骑士提供，全队法术攻击+10%
- **力量祝福**: 圣骑士提供，全队物理攻击+10%

#### 2. 防御协同

- **护盾**: 法师提供，为前排角色增加护盾
- **治疗链**: 萨满提供，连锁治疗多个队友
- **群体治疗**: 牧师提供，恢复所有队友生命值

#### 3. 控制协同

- **群体控制**: 多个角色同时使用控制技能
- **打断协同**: 多个角色轮流打断敌人技能
- **减速协同**: 多个角色叠加减速效果

### 协同技能配置

```sql
-- 协同技能配置表
CREATE TABLE team_synergy_skills (
    id VARCHAR(32) PRIMARY KEY,
    skill_id VARCHAR(32) NOT NULL,
    synergy_type VARCHAR(32) NOT NULL,  -- buff/defense/control
    target_type VARCHAR(32) NOT NULL,  -- self/ally/all/allies
    effect_value REAL NOT NULL,
    FOREIGN KEY (skill_id) REFERENCES skills(id)
);
```

---

## 队伍属性计算

### 队伍总属性

```
队伍总HP = Σ(角色HP)
队伍总攻击 = Σ(角色攻击)
队伍总防御 = Σ(角色防御)
```

### 队伍加成

#### 1. 职业加成

```
同职业加成:
├─ 2个同职业: 全队攻击+5%
├─ 3个同职业: 全队攻击+10%
└─ 4个以上同职业: 全队攻击+15%
```

#### 2. 定位加成

```
完整队伍加成 (有坦克+治疗+DPS):
├─ 全队攻击+10%
├─ 全队防御+10%
└─ 全队生命+10%
```

#### 3. 种族加成

```
同种族加成:
├─ 2个同种族: 全队属性+3%
└─ 3个以上同种族: 全队属性+5%
```

### 队伍Buff

#### 战斗Buff

- **团队协作**: 全队攻击+5%，防御+5%
- **战术配合**: 全队暴击率+3%
- **默契配合**: 全队闪避率+3%

#### 生存Buff

- **团队守护**: 全队生命+10%
- **团队坚韧**: 全队防御+10%
- **团队恢复**: 全队每回合恢复生命值

---

## 队伍战斗

### 战斗流程

```
1. 战斗初始化
   ├─ 加载队伍角色
   ├─ 按速度排序
   └─ 初始化仇恨值

2. 回合循环
   ├─ 角色1行动 (根据策略)
   ├─ 角色2行动 (根据策略)
   ├─ ...
   ├─ 敌人行动 (根据AI和仇恨)
   └─ 回合结束处理

3. 胜负判定
   ├─ 所有角色死亡 → 失败
   └─ 所有敌人死亡 → 胜利
```

### 仇恨系统

#### 仇恨计算

```
基础仇恨 = 伤害量 × 仇恨系数
治疗仇恨 = 治疗量 × 0.5 (分摊给所有敌人)
嘲讽仇恨 = 强制成为第一仇恨
```

#### 目标选择

```
敌人选择目标:
1. 检查是否有嘲讽目标
2. 选择仇恨最高的角色
3. 如果仇恨相同，优先攻击前排
```

---

## 数据库设计

### 队伍表

```sql
-- 用户队伍表 (已存在，扩展)
ALTER TABLE users ADD COLUMN max_team_size INTEGER DEFAULT 1;
ALTER TABLE users ADD COLUMN unlocked_slots INTEGER DEFAULT 1;
```

### 角色槽位表

```sql
-- 角色表已有 team_slot 字段
-- team_slot: 1-5 表示队伍中的位置
```

---

## 总结

### 设计亮点

1. **灵活的队伍规模**: 从1人到5人，逐步解锁
2. **清晰的槽位系统**: 每个槽位有明确的定位
3. **丰富的搭配选择**: 支持多种队伍组合
4. **强大的协同机制**: 队伍成员可以相互配合

### 后续扩展

- [ ] 队伍预设系统
- [ ] 队伍快速切换
- [ ] 队伍分析工具
- [ ] 队伍推荐系统

---

**文档版本**: v1.0  
**最后更新**: 2025年


